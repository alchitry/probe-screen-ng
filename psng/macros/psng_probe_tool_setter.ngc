o<psng_probe_tool_setter> sub

; BEGIN PSNG PREAMBLE
M73 ; Save and autorestore model states. This will be used only in case of error, otherwise we will invalidate it.
o<psng_modal_save> call
o<psng_hook> call [4]
; END PSNG PREAMBLE

; first go up then move to tool sensor position
G90
G53 G0 Z[#<_ini[AXIS_Z]MAX_LIMIT>+#<_ini[PROBE_SCREEN]Z_SAFE_TRAVEL_OFFSET>]
G53 G0 X[#<_ini[TOOLSENSOR]X>] Y[#<_ini[TOOLSENSOR]Y>]
G53 G0 Z[#<_ini[TOOLSENSOR]Z>]

(cancel all Z offsets)
G92.1
G49
G10 L20 P0  Z[#<_hal[axis.z.pos-cmd]>]

G91
F #<_hal[probe.ps_searchvel]>
G38.2 Z #<_ini[TOOLSENSOR]MAXPROBE>
G1 Z[#<_hal[probe.ps_probe_latch]>] F#<_ini[TOOLSENSOR]RAPID_SPEED>
F #<_hal[probe.ps_probevel]>
G4 P0.5
G38.2 Z[-#<_hal[probe.ps_probe_latch]>*2]
G90
G53 G1 Z[#<_ini[TOOLSENSOR]Z>] F#<_ini[TOOLSENSOR]RAPID_SPEED>	

; BEGIN PSNG POSTAMBLE
M71 ; Invalidate Modal Autorestore
o<psng_modal_restore> call
; END PSNG POSTAMBLE

o<psng_probe_tool_setter> endsub
M2
